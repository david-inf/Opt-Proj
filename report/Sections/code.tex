% !TeX spellcheck = en_GB
% ***************************************************** %
%\section{Pseudo-code}\label{sc:code}
% ***************************************************** %

\newcommand{\forcond}{$t=0$ \KwTo $N/M-1$}
%\newcommand{\shuffleDB}{shuffle $\set{1,\dots,N}$ and split $B_0,\dots,B_{N/M-1}$ s.t. $1<\abs{B_t}=M\ll N$}
\newcommand{\shuffleDB}{create mini-batches $B_0,\dots,B_{N/M-1}$}
\newcommand{\getIdx}{get indices $i_t$ from $B_t$}
\newcommand{\algGrad}{$\nabla f_{i_t}(y_t) \gets \frac{1}{M}\sum_{j\in B_t}\nabla f_j(y_t)$}
\newcommand{\stopping}{$\norma{\nabla\func(w^k)}>\epsilon$ \And $k<k^\ast$}

\begin{algorithm}
\caption{\texttt{SGD-Fixed}, \texttt{SGD-Decreasing}, \texttt{SGDM}}\label{alg:SGD-F-D-M}
\KwData{$w^0\in\R^{(p+1)}$, $M>1$, $k^\ast$, $\epsilon>0$, $\alpha_0\in\R^+$, $\beta_0\in(0,1)$}
\uIf{\texttt{SGD-Fixed}}{$\set{\alpha_k}\gets\alpha_0$, $\set{\beta_k}\gets0$\;}
\uElseIf{\texttt{SGD-Decreasing}}{$\set{\alpha_k}\gets\frac{\alpha_0}{k+1}$, $\set{\beta_k}\gets0$\;}
\ElseIf{\texttt{SGDM}}{$\set{\alpha_k}\gets\alpha_0$, $\set{\beta_k}\gets\beta_0$\;}
$k \gets 0$\;
\While{\stopping}{
	\shuffleDB\;
	$y_0 \gets w^k$\;
	$d_{-1}\gets0$\;
	\For{\forcond}{
		get indices $i_t$ from $B_t$\;
		\algGrad\;
		$d_t\gets-\bigl((1-\beta_0)\nabla f_t(y_t)+\beta_0d_{t-1}\bigr)$\;
		$y_{t+1} \gets y_t+\alpha_kd_t$\;
	}
	$w^{k+1} \gets y_{N/M}$\;
	$k \gets k+1$\;
}
\end{algorithm}

\begin{algorithm}
\caption{\texttt{SGD-Armijo}, \texttt{MSL-SGDM-C}, \texttt{MSL-SGDM-R}}\label{alg:SGD-SLS-M}
\KwData{$w^0\in\R^{(p+1)}$, $M>1$, $k^\ast$, $\epsilon>0$, $\alpha_0$, $\beta_0$}
$k \gets 0$\;
\While{\stopping}{
	\shuffleDB\;
	$y_0 \gets w^k$\;
	$d_{-1}\gets0$\;
	\For{\forcond}{
		\getIdx\;
		\algGrad\;
		\uIf{\texttt{SGD-Armijo}}{$d_t\gets-\nabla f_{i_t}(y_t)$\;}
		\uElseIf{\texttt{MSL-SGDM-C}}{$d_t\gets\mathtt{correction(}\beta_0,\nabla f_{i_t}(y_t),d_{t-1}\mathtt{)}$ see~\ref{alg:m-correction}\;}
		\ElseIf{\texttt{MSL-SGDM-R}}{$d_t\gets\mathtt{restart(}\beta_0,\nabla f_{i_t}(y_t),d_{t-1}\mathtt{)}$ see~\ref{alg:m-restart}\;}
		$\alpha\gets\mathtt{reset(}\alpha_{t-1},\alpha_0,M,N,t\mathtt{)}/\delta$ see~\ref{alg:reset-step}\; 
		$\alpha_t\gets\mathtt{armijo(}y_t,d_t,\alpha\mathtt{)}$ see~\ref{alg:armijo}\;
		$y_{t+1}\gets y_t+\alpha_td_t$
	}
	$w^{k+1} \gets y_{N/M}$\;
	$k \gets k+1$\;
}
\end{algorithm}

\noindent%
\begin{minipage}[t]{0.35\textwidth}
\vspace{0pt}
\begin{algorithm}[H]
\caption{\texttt{reset}}\label{alg:reset-step}
\KwData{$a\in\R^+$, $\mathtt{opt}\in\set{0,1,2}$}
\KwIn{$\alpha$, $\alpha_0$, $M$, $N$, $t$}
\uIf{$t=0$}{\KwRet{$\alpha_0$}}
\uElseIf{$\mathtt{opt}=0$}{$\alpha\gets\alpha$}
\uElseIf{$\mathtt{opt}=1$}{$\alpha\gets\alpha_0$}
\ElseIf{$\mathtt{opt}=2$}{$\alpha\gets\alpha a^{M/N}$}
\KwOut{$\alpha$}
\end{algorithm}
\end{minipage}%
\begin{minipage}[t]{0.65\textwidth}
\vspace{0pt}
\begin{algorithm}[H]
\caption{\texttt{armijo}}\label{alg:armijo}
\KwData{$\gamma\in(0,1)$, $\delta\in(0,1)$, $q^\ast$}
\KwIn{$y_t$, $d_t$, $\alpha$}
$\alpha_t\gets\alpha$\;
$q\gets0$\;
\Repeat{$f_{i_t}(y_{t+1})\leq f_{i_t}(y_t)+\gamma\alpha_t\nabla f_{i_t}(y_{t-1})^Td_t$ \Or $q\geq q^\ast$}{
	$\alpha_t\gets\delta\alpha_t$\;
	$y_{t+1} \gets y_t+\alpha_td_t$\;
	$q\gets q+1$\;
}
\KwOut{$\alpha_t$}
\end{algorithm}
\end{minipage}

\noindent%
\begin{minipage}[t]{0.49\textwidth}
\vspace{0pt}
\begin{algorithm}[H]
\caption{\texttt{correction}}\label{alg:m-correction}
\KwData{$\delta\in(0,1)$, $q^\ast$}
\KwIn{$\beta_0$, $\nabla f_{i_t}(y_t)$, $d_{t-1}$}
$\beta\gets\beta_0$\;
$q\gets0$\;
\Repeat{$\nabla f_{i_t}(y_t)^Td_t<0$ \Or $q\geq q^\ast$}{
	$\beta\gets\delta\beta$\;
	$d_t\gets-\bigl((1-\beta)\nabla f_{i_t}(y_t)+\beta d_{t-1}\bigr)$\;
	$q\gets q+1$\;
}
$\beta_t\gets\beta$\;
$d_t\gets-\bigl((1-\beta_t)\nabla f_{i_t}(y_t)+\beta_td_{t-1}\bigr)$\;
\KwOut{$d_t$}
\end{algorithm}
\end{minipage}%
\begin{minipage}[t]{0.49\textwidth}
\vspace{0pt}
\begin{algorithm}[H]
\caption{\texttt{restart}}\label{alg:m-restart}
\KwData{$d_0$}
\KwIn{$\beta_0$, $\nabla f_{i_t}(y_t)$, $d_{t-1}$}
$q\gets0$\;
$d_t\gets-\bigl((1-\beta_0)\nabla f_{i_t}(y_t)+\beta_0d_{t-1}\bigr)$\;
\If{\Not$\nabla f_{i_t}(y_t)^Td_t<0$}{
	$d_{t-1}\gets d_0$\;
	$d_t\gets-\bigl((1-\beta_0)\nabla f_{i_t}(y_t)+\beta_0d_{t-1}\bigr)$\;
}
\KwOut{$d_t$}
\end{algorithm}
\end{minipage}
